### 一、数据库格式
#### 1、`key`表

| Key        | time         | state       | appid       |
| ---------- | ------------ | ----------- | ----------- |
| （授权码） | （授权时间） | (授权状态） | (授权应用） |


> 授权时间：-1永久、30一个月、365一年
> 授权状态：0为未使用、1为已使用

#### 2、`auth`表

| key        | domain       | time         | state        | cert         | token         | hash       |
| ---------- | ------------ | ------------ | ------------ | ------------ | ------------- | ---------- |
| （授权码） | （授权域名） | （授权时间） | （授权状态） | （授权证书） | （授权token） | （哈希值） |

> 授权时间：-1永久、30一个月、365一年
> 授权状态：0为未使用、1为已使用
> 授权证书：由域名生成自签证书
> 授权Token：随机生成一个32位的字符串（大小写字母+数字组合）
> 哈希值：由`授权证书`、`授权Token`得出

#### 3、`cert`表

| domain       | cert         | Private      | token         | hash       |
| ------------ | ------------ | ------------ | ------------- | ---------- |
| （授权域名） | （授权证书） | （证书私钥） | （授权Token） | （哈希值） |

> 授权证书：由域名生成自签证书
> 证书私钥：自签证书的私钥
> 授权Token：随机生成一个32位的字符串（大小写字母+数字组合）
> 哈希值：由`授权证书`、`授权Token`得出

#### 4、`unauth`表

| domain       | time         |
| ------------ | ------------ |
| （授权域名） | （上报时间） |

#### 5、`apps`表

| appid      | name         | Download     | version      |
| ---------- | ------------ | ------------ | ------------ |
| （应用ID） | （应用名称） | （下载直链） | （应用版本） |

#### 6、`appconfig`表

| MoIP           | MoPo             | MoUs               | MoPs             | Adname           | Adpsd          |      |
| -------------- | ---------------- | ------------------ | ---------------- | ---------------- | -------------- | ---- |
| （MongoDB IP） | （MongoDB 端口） | （MongoDB 用户名） | （MongoDB 密码） | （WebUI 用户名） | （WebUI 密码） |      |

### 二、证书以及哈希值
#### 1、获取绑定域名生成证书以及私钥
1. 主题信息
> 通用名CN：（网站域名）
> 组织O：冥雾授权站
> 城市L：Changchun
> 省份S：Jilin
> 国家C：CN
2. 签发者信息
> 通用名CN：AUth 
> 组织O：（所属应用ID） 
> 国家C：CN
3. 证书信息
> 颁发时间：（当前时间）
> 过期时间：（当前时间10年后）
> 密钥算法：RSA
#### 2、生成Token
随机生成一个32位的字符串（大小写字母+数字组合）
#### 3、进行Base64加密
将`证书`进行Base64加密
#### 4、计算得出哈希值
拼接`Base64加密后的字符串`以及`Token`
计算哈希值
#### 5、数据库保存
`cert`表以及`auth`表所保存的证书为Base64编码后的证书
`cert`表中的私钥为Base64编码后的私钥
`cert`表以及`auth`表所保存的Token以及has均为原文
